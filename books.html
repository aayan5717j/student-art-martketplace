<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Book Exchange - Student Art Hub</title>
<link rel="stylesheet" href="styles.css" />
</head>
<body>

<header>
<div class="container">
<h1>Student Art Hub</h1>
<nav>
<a href="index.html">Home</a>
<a href="art.html">Art Showcase</a>
<a href="books.html">Book Exchange</a>
<a href="sketches.html">Custom Sketches</a>
<a href="notes.html">Handwritten Notes</a>
    <a href="donations.html">Donations</a>
</nav>
</div>
</header>

<main class="container">
<section>
<h2>Book Exchange</h2>

<!-- Seller Upload -->
<div id="uploadSection" style="display:none;">
<h3>Upload a Book</h3>
<input type="text" id="bookName" placeholder="Book Name">
<input type="text" id="bookDesc" placeholder="Description">
<input type="number" id="bookPrice" placeholder="Price">
<input type="file" id="bookImage" accept="image/*">
<select id="bookClass">
<option value="">Select Class</option>
<option value="1">Class 1</option>
<option value="2">Class 2</option>
<option value="3">Class 3</option>
<option value="4">Class 4</option>
<option value="5">Class 5</option>
<option value="6">Class 6</option>
<option value="7">Class 7</option>
<option value="8">Class 8</option>
<option value="9">Class 9</option>
<option value="10">Class 10</option>
<option value="11">Class 11</option>
<option value="12">Class 12</option>
</select>
<button id="uploadBtn">Upload Book</button>
</div>

<!-- Search + Filter -->
<input type="text" id="searchInput" placeholder="Search by name or description">
<select id="classFilter">
<option value="">All Classes</option>
<option value="1">Class 1</option>
<option value="2">Class 2</option>
<option value="3">Class 3</option>
<option value="4">Class 4</option>
<option value="5">Class 5</option>
<option value="6">Class 6</option>
<option value="7">Class 7</option>
<option value="8">Class 8</option>
<option value="9">Class 9</option>
<option value="10">Class 10</option>
<option value="11">Class 11</option>
<option value="12">Class 12</option>
</select>

<div class="listings" id="bookListings"></div>
</section>
</main>

<!-- Cart -->
<div id="cart" style="position:fixed;top:80px;right:20px;width:250px;background:#fff;border:1px solid #ccc;padding:10px;display:none;z-index:1000;">
<h3>Cart</h3>
<ul id="cartItems"></ul>
<strong>Total: â‚¹<span id="cartTotal">0</span></strong><br><br>
<button id="checkoutBtn">Checkout</button>
<button id="closeCart">Close</button>
</div>
<button id="openCart" style="position:fixed;top:20px;right:20px;z-index:1000;">ðŸ›’ Cart</button>

<footer>
<div class="container"><p>Â© 2025 Student Art Hub</p></div>
</footer>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBxD8SLW9z8ndgAJprcGolqivlNUZVYZxc",
  authDomain: "art-hub-77eb1.firebaseapp.com",
  projectId: "art-hub-77eb1",
  storageBucket: "art-hub-77eb1.appspot.com",
  messagingSenderId: "1097170910592",
  appId: "1:1097170910592:web:8590c10f6d0662d6881565"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore(app);
const storage = getStorage(app);

let books = [];
let sellerData = {uid:"", phone:""};

const uploadSection = document.getElementById('uploadSection');
const bookListings = document.getElementById('bookListings');

// Show upload section only for logged in users
onAuthStateChanged(auth, user=>{
  if(user){
    sellerData.uid = user.uid;
    sellerData.phone = user.phoneNumber || "";
    uploadSection.style.display = "block";
  }
});

// Upload book
document.getElementById('uploadBtn').addEventListener('click', async()=>{
  const name = document.getElementById('bookName').value;
  const desc = document.getElementById('bookDesc').value;
  const price = parseInt(document.getElementById('bookPrice').value);
  const cls = document.getElementById('bookClass').value;
  const file = document.getElementById('bookImage').files[0];

  if(!name || !price || !cls || !file){ alert("Fill all fields and select image"); return; }

  // Upload image to Firebase Storage
  const fileName = Date.now() + "-" + file.name;
  const storageRef = ref(storage,"books/"+fileName);
  await uploadBytes(storageRef, file);
  const imageUrl = await getDownloadURL(storageRef);

  const book = {name, desc, price, class:cls, sellerUid: sellerData.uid, sellerPhone: sellerData.phone, imageUrl};
  books.push(book);
  renderBooks(books);

  // Save to Firestore
  await addDoc(collection(db,"books"), book);

  alert("Book uploaded successfully!");
});

// Render books
function renderBooks(list){
  bookListings.innerHTML="";
  list.forEach((book,i)=>{
    const div = document.createElement('article');
    div.className='item';
    div.innerHTML = `
      <img src="${book.imageUrl}" width="150" style="border-radius:10px;"><br>
      <h3>${book.name}</h3>
      <p>${book.desc}</p>
      <p>Class: ${book.class}</p>
      <p class="price">â‚¹${book.price}</p>
      <button onclick="buyBook(${i})">Buy</button>
    `;
    bookListings.appendChild(div);
  });
}

// Buy book
window.buyBook = function(i){
  const book = books[i];
  let buyerNumber = prompt("Enter your WhatsApp number (with country code e.g. +91xxxx):");
  if(!buyerNumber){ alert("Number required"); return; }

  // WhatsApp message to seller
  const msg = `Hi! I want to buy your book:\nTitle: ${book.name}\nPrice: â‚¹${book.price}\nBuyer's number: ${buyerNumber}`;
  const waUrl = `https://wa.me/${book.sellerPhone.replace('+','')}?text=${encodeURIComponent(msg)}`;
  window.open(waUrl,'_blank');

  alert("WhatsApp message opened to seller!");
}

// Search + filter
document.getElementById('searchInput').addEventListener('input',filterBooks);
document.getElementById('classFilter').addEventListener('change',filterBooks);

function filterBooks(){
  const query = document.getElementById('searchInput').value.toLowerCase();
  const cls = document.getElementById('classFilter').value;
  renderBooks(books.filter(book=>{
    const matchesSearch = book.name.toLowerCase().includes(query)||book.desc.toLowerCase().includes(query);
    const matchesClass = cls? book.class===cls : true;
    return matchesSearch && matchesClass;
  }));
}
</script>
</body>
</html>
