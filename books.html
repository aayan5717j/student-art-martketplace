<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Book Exchange - Student Art Hub</title>
<link rel="stylesheet" href="styles.css" />
</head>
<body>

<header>
<div class="container">
<h1>Student Art Hub</h1>
<nav>
<a href="index.html">Home</a>
<a href="art.html">Art Showcase</a>
<a href="books.html">Book Exchange</a>
<a href="sketches.html">Custom Sketches</a>
<a href="notes.html">Handwritten Notes</a>
</nav>
</div>
</header>

<main class="container">
<section>
<h2>Book Exchange</h2>

<!-- Seller Upload -->
<div id="uploadSection" style="display:none;">
<h3>Upload a Book</h3>
<input type="text" id="bookName" placeholder="Book Name">
<input type="text" id="bookDesc" placeholder="Description">
<input type="number" id="bookPrice" placeholder="Price">
<select id="bookClass">
<option value="">Select Class</option>
<option value="1">Class 1</option>
<option value="2">Class 2</option>
<option value="3">Class 3</option>
<option value="4">Class 4</option>
<option value="5">Class 5</option>
<option value="6">Class 6</option>
<option value="7">Class 7</option>
<option value="8">Class 8</option>
<option value="9">Class 9</option>
<option value="10">Class 10</option>
<option value="11">Class 11</option>
<option value="12">Class 12</option>
</select>
<button id="uploadBtn">Upload Book</button>
</div>

<!-- Search + Filter -->
<input type="text" id="searchInput" placeholder="Search by name or description">
<select id="classFilter">
<option value="">All Classes</option>
<option value="1">Class 1</option>
<option value="2">Class 2</option>
<option value="3">Class 3</option>
<option value="4">Class 4</option>
<option value="5">Class 5</option>
<option value="6">Class 6</option>
<option value="7">Class 7</option>
<option value="8">Class 8</option>
<option value="9">Class 9</option>
<option value="10">Class 10</option>
<option value="11">Class 11</option>
<option value="12">Class 12</option>
</select>

<div class="listings" id="bookListings"></div>
</section>
</main>

<!-- Cart -->
<div id="cart" style="position:fixed;top:80px;right:20px;width:250px;background:#fff;border:1px solid #ccc;padding:10px;display:none;z-index:1000;">
<h3>Cart</h3>
<ul id="cartItems"></ul>
<strong>Total: â‚¹<span id="cartTotal">0</span></strong><br><br>
<button id="checkoutBtn">Checkout</button>
<button id="closeCart">Close</button>
</div>
<button id="openCart" style="position:fixed;top:20px;right:20px;z-index:1000;">ðŸ›’ Cart</button>

<footer>
<div class="container"><p>Â© 2025 Student Art Hub</p></div>
</footer>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBxD8SLW9z8ndgAJprcGolqivlNUZVYZxc",
  authDomain: "art-hub-77eb1.firebaseapp.com",
  projectId: "art-hub-77eb1",
  storageBucket: "art-hub-77eb1.appspot.com",
  messagingSenderId: "1097170910592",
  appId: "1:1097170910592:web:8590c10f6d0662d6881565"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();

let books = []; // Store uploaded books

const uploadSection = document.getElementById('uploadSection');
onAuthStateChanged(auth, async user=>{
  if(user){
    // TODO: fetch role from Firestore
    const role = 'seller'; // replace with actual role fetch
    if(role==='seller'){ uploadSection.style.display='block'; }
  }
});

// Upload book
document.getElementById('uploadBtn').addEventListener('click',()=>{
  const name = document.getElementById('bookName').value;
  const desc = document.getElementById('bookDesc').value;
  const price = parseInt(document.getElementById('bookPrice').value);
  const cls = document.getElementById('bookClass').value;
  if(!name||!price||!cls){ alert("Fill all fields"); return; }
  books.push({name,desc,price,class:cls});
  renderBooks(books);
  alert("Book uploaded!");
});

// Render Books
const bookListings = document.getElementById('bookListings');
function renderBooks(list){
  bookListings.innerHTML='';
  list.forEach(book=>{
    const div=document.createElement('article');
    div.className='item';
    div.innerHTML=`
      <h3>${book.name}</h3>
      <p>${book.desc}</p>
      <p>Class: ${book.class}</p>
      <p class="price">â‚¹${book.price}</p>
      <button onclick="addToCart('${book.name}',${book.price})">Buy</button>
    `;
    bookListings.appendChild(div);
  });
}

// Search + Filter
document.getElementById('searchInput').addEventListener('input',()=>filterBooks());
document.getElementById('classFilter').addEventListener('change',()=>filterBooks());
function filterBooks(){
  const query = document.getElementById('searchInput').value.toLowerCase();
  const cls = document.getElementById('classFilter').value;
  renderBooks(books.filter(book=>{
    const matchesSearch = book.name.toLowerCase().includes(query)||book.desc.toLowerCase().includes(query);
    const matchesClass = cls? book.class===cls : true;
    return matchesSearch && matchesClass;
  }));
}

// Cart Logic
const cartItems = document.getElementById('cartItems');
const cartTotal = document.getElementById('cartTotal');
const cartDiv = document.getElementById('cart');
const openCartBtn = document.getElementById('openCart');
const closeCartBtn = document.getElementById('closeCart');
const checkoutBtn = document.getElementById('checkoutBtn');

window.addToCart=(name,price)=>{
  let cart=JSON.parse(localStorage.getItem('cart'))||[];
  cart.push({name,price});
  localStorage.setItem('cart',JSON.stringify(cart));
  alert(name+" added to cart!");
  updateCartUI();
}

function updateCartUI(){
  let cart=JSON.parse(localStorage.getItem('cart'))||[];
  cartItems.innerHTML='';
  let total=0;
  cart.forEach(item=>{
    const li=document.createElement('li');
    li.textContent=`${item.name} - â‚¹${item.price}`;
    cartItems.appendChild(li);
    total+=parseInt(item.price);
  });
  cartTotal.textContent=total;
}
openCartBtn.addEventListener('click',()=>{updateCartUI(); cartDiv.style.display='block';});
closeCartBtn.addEventListener('click',()=>{cartDiv.style.display='none';});

// Razorpay Checkout
checkoutBtn.addEventListener('click',()=>{
  let cart=JSON.parse(localStorage.getItem('cart'))||[];
  if(cart.length===0){ alert("Cart empty!"); return; }
  let totalAmount=cart.reduce((sum,item)=>sum+parseInt(item.price),0)*100;
  const options={
    key:"YOUR_RAZORPAY_KEY_HERE",
    amount:totalAmount,
    currency:"INR",
    name:"Student Art Hub",
    description:"Purchase",
    handler:function(response){
      alert("Payment Successful! ID: "+response.razorpay_payment_id);
      localStorage.removeItem('cart'); updateCartUI(); cartDiv.style.display='none';
    },
    theme:{color:"#3399cc"}
  };
  const rzp=new Razorpay(options);
  rzp.open();
});
</script>
<script src="script.js"></script>
</body>
</html>